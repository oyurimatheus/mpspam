var Armas={tratarSubmit:function(a,o){a.preventDefault();var r=o.elements.chave.value,e=$("#"+r).data("registros-armas");$("#"+r+"-lista-filtro").attr("data-active",""),$("#"+r+"-lista-filtro > div").attr("style","right: 0px; display: none;");for(var i=$("#"+r+"-numeroSinarm").val(),t=$("#"+r+"-marca").val(),s=$("#"+r+"-modelo").val(),n=$("#"+r+"-especie").val(),l=$("#"+r+"-calibre").val(),d=[],c=0;c<e.length;c++)Filtro.filtrarString(i,e[c].numeroSinarm)&&Filtro.filtrarString(t,e[c].marca)&&Filtro.filtrarString(s,e[c].modelo)&&Filtro.filtrarString(n,e[c].especie)&&Filtro.filtrarString(l,e[c].calibre)&&d.push(e[c]);var m=[];0<d.length?(m.success=!0,m.payload=d,m.msgRetorno="Filtro retornou "+d.length+" resultados"):(m.success=!1,m.msgRetorno="Nenhum registro encontrado!"),Armas.consultarArmasFiltroOk(m,r)},consultarArmasFiltroOk:function(a,o){Filtro.limparListagemConteudo(o);!0===a.success&&null!=a.payload&&0<a.payload.length&&(Armas.paginaDadosArmas(o,1,10,a),Armas.paginarResultadosArmas(o,a.payload.length,a,Armas.paginaDadosArmas,10),Report.showOrHideCheckboxAll(o)),Filtro.mostrarMensagemFiltro(o,a.msgRetorno)},consultarArmaOk:function(a,o,r,e){Funcoes.consoleLogResult("consultarArmaOk",a,o,r),criarEstruturaListagemResultados(e);var i=document.getElementById(e+"-lista-conteudo");if(!0===a.success){if(null!=a.payload&&0<a.payload.length){$("#"+e).data("registros-armas",a.payload),Counters.counterAdd(e,COD_SERVICO.SRV_ARMAS,a.payload.length);Armas.paginaDadosArmas(e,1,10,a),Armas.paginarResultadosArmas(e,a.payload.length,a,Armas.paginaDadosArmas,10),Report.showOrHideCheckboxAll(e)}}else gerarMensagemInsucesso(i,a.msgRetorno)},paginaDadosArmas:function(a,o,r,e){var i=e.payload.length,t=document.getElementById(a+"-lista-conteudo");if(r<o||o<1||i<o)gerarMensagemInsucesso(t,"Dados de paginação inválidos");else{$(t).empty(),30<r-(o-=1)&&(r=o+30),i<r&&(r=i);for(var s=o;s<r;s++){var n=a+"-"+s,l=e.payload[s];Armas.gerarDadosBasicosArmas(t,l,n),Armas.gerarDadosDetalhados(t,l,n)}}},paginarResultadosArmas:function(r,a,e,i,t){null!==t&&0!==t||(t=10);var o=$("<div id='"+r+"-pag'/>");$("#"+r+"-lista-conteudo").after(o);var s=parseInt(a/t);0<a%t&&(s+=1),1<s&&(Filtro.gerarBotaoDeFiltro(r,Armas.gerarFormularioDeFiltroDeArmas,COD_SERVICO.SRV_ARMAS,a),$(o).bootpag({total:s,page:1,maxVisible:10,firstLastUse:!0}).on("page",function(a,o){a.preventDefault(),Report.setStateCheckboxAll(r,!1),i(r,(o-1)*t+1,o*t,e)}))},gerarFormularioDeFiltroDeArmas:function(a,o){$(o).off("click");var r=$("<div class='sinesp-dropdown-menu sinesp-popover text-left'><form id='frm-"+a+"' class='form frm-filtro-armas' novalidate><input type='hidden' value='"+a+"' name='chave'/><div class='row sinesp-filter-row-small'><div class='col-md-12'><div class='form-group'><label>Número SINARM</label><input type='text' class='form-control' id='"+a+"-numeroSinarm' maxlength='50'  onkeypress='return Funcoes.isNumeroDigitado(event)'/></div><div class='form-group'><label>Marca</label><input type='text' class='form-control' id='"+a+"-marca' maxlength='50' /></div><div class='form-group'><label>Modelo</label><input type='text' class='form-control' id='"+a+"-modelo' maxlength='50' /></div><div class='form-group'><label>Espécie</label><input type='text' class='form-control' id='"+a+"-especie' maxlength='50' /></div><div class='form-group'><label>Calibre</label><input type='text' class='form-control' id='"+a+"-calibre' maxlength='50' /></div><div class='form-group text-right'><button id='"+a+"-btn-limpar-formulario' class='btn btn-primary' type='button' onclick='Filtro.limparFormulario(this.form)'>Limpar</span></button>&nbsp;&nbsp;&nbsp;<button id='"+a+"-btn-filtrar-pesquisa' type='submit' class='btn btn-primary'> Filtrar &nbsp; <span class='glyphicon glyphicon-search'></span></button></div></div></div></form></div>");$("#"+a+"-lista-filtro").append(r)},gerarDadosBasicosArmas:function(a,o,r){var e=document.createElement("div");e.setAttribute("id",r),Report.checkbox(e,o.numeroSinarm,COD_SERVICO.SRV_ARMAS,o);var i=Armas.dadosBasicos(o);$(e).append(i),$(a).append(e),$(e).find(".row:eq(0)").find("div").first().find("p").on("click",function(){util.popOverSubEl(e.id,e.id+"-popover")})},reportItemArma:function(a,o,r){var e=document.createElement("div");e.setAttribute("id",r);var i=Armas.dadosBasicos(o);$(e).append(i),$(a).append(e),$(e).find(".row:eq(0)").find("div").first().find("p").on("click",function(){Armas.realizarBuscaDetalhesArmaParaAdicionarNoRelatorio(o.numeroSinarm,e)})},realizarBuscaDetalhesArmaParaAdicionarNoRelatorio:function(o,r){util.confirm("Confirma a inclusão do detalhamento do item no relatório?").done(function(){var a={sinarm:o};genericRequest(ArmasProxy.getArmasPorSINARM,a,Armas.consultarDetalhesArmaParaAdicionarNoRelatorioOk,r.id)}).fail()},consultarDetalhesArmaParaAdicionarNoRelatorioOk:function(a,o,r,e){Report.adicionaDetalhamentoItem(a,e,COD_SERVICO.SRV_ARMAS,"numeroSinarm")},dadosBasicos:function(a){return null==a.porte?linhaResult("2","Número SINARM",a.numeroSinarm,"","3","Marca",NI(a.marca),"","4","Modelo",NI(a.modelo),"","2","Espécie",NI(a.especie),"","1","Calibre",NI(a.calibre),""):linhaResult("2","Número SINARM",a.numeroSinarm,"","3","Marca",NI(a.marca),"","4","Modelo",NI(a.modelo),"","2","Espécie",NI(a.especie),"","1","Calibre",NI(a.calibre),"","5","Porte - Nome",NI(a.porte.nomeDonoPorte),"","3","Porte - CPF",NI(a.porte.cpfDonoPorte),"")},gerarDadosDetalhados:function(a,o,r){var e=document.createElement("div");e.setAttribute("id",r+"-popover"),e.setAttribute("hidden",""),e.setAttribute("title","Arma"),$(a).append(e),Report.checkboxDetails(e,o.numeroSinarm,COD_SERVICO.SRV_ARMAS,o);var i=Armas.dadosDetalhe(o);resultPopOver2Abas(e,r,"-detalhe","Detalhes da Arma",i,"-proprietario","Dados do Proprietário",Armas.realizarBuscaPorProprietario,o.numeroSinarm)},reportItemDetalhe:function(a,o,r){var e=document.createElement("div");e.setAttribute("id",r);var i=Armas.dadosDetalhe(o);$(e).append(i),null!=o.proprietarioArma&&Armas.gerarDadosProprietario(e,o.proprietarioArma,!0),$(a).append(e)},dadosDetalhe:function(a){var o=linhaResult("4","Número SINARM",a.numeroSinarm,"","4","Marca",NI(a.marca),"","4","Modelo",NI(a.modelo),"","4","Número de Série",a.numeroSerie,"","4","Espécie",NI(a.especie),"","4","País de Fabricação",a.paisFabricacao,"","4","Calibre",NI(a.calibre),"","4","Acabamento",NI(a.acabamento),"","4","Categoria",NI(a.categoria),"","4","Funcionamento",NI(a.funcionamento),"","4","Sentido da Raia",NI(a.sentidoRaia),"","4","Alma",NI(a.alma),"","4","Quant. Canos",NI(a.qtdCanos),"","4","Comprimento do Cano",NI(a.comprimentoCano),"","4","Número de Raias",NI(a.numeroRaias),"","4","Quant. Tiros",NI(a.qtdTiros),"","4","Número de Registro",NI(a.numeroRegistro),"","4","Órgão Expedidor do Registro",NI(a.orgaoExpeditorRegistro),"","4","UF do Órgão Expedidor do Registro",NI(a.ufOrgaoExpeditorRegistro),"","4","Número da Nota Fiscal",NI(a.numeroNotaFiscal),"","4","Data da Nota Fiscal",NI(a.dataNotaFiscal),"","4","Validade do Registro",NI(a.validadeRegistro),"","4","Observações",NI(a.observacoes),"","4","Situação",NI(a.situacao),"");return null!=a.porte&&(o+="<div class='list row'><p><b>Dados do Porte</b></p>"+linhaResult("4","Porte - Nome",NI(a.porte.nomeDonoPorte),"","4","Porte - CPF",NI(a.porte.cpfDonoPorte),"","4","Porte - Abrangência",NI(a.porte.abrangencia),"","4","Porte - Data de Emissão",NI(a.porte.dataEmissao),"","4","Porte - Data de Validade",NI(a.porte.dataValidade),"","4","Porte - Número do Porte",NI(a.porte.numeroPorte),"","4","Porte - Órgão Expedidor",NI(a.porte.orgaoExpeditor),"","4","Porte - Tipo da Ocorrência",NI(a.porte.tipoOcorrencia),"","4","Porte - Tipo do Porte",NI(a.porte.tipoPorte),"","4","Porte - Observações",NI(a.porte.observacoes),"")+"</div>"),o},realizarBuscaPorProprietario:function(a,o){var r={sinarm:a};genericRequest(ArmasProxy.getProprietarioArmaPorSINARM,r,Armas.consultarProprietarioOk,o,!1)},consultarProprietarioOk:function(a,o,r,e){var i=document.getElementById(e);!0===a.success?null!=a.payload&&($("#tab-"+e).off("click"),Armas.gerarDadosProprietario(i,a.payload,!1)):gerarMensagemInsucesso(i,a.msgRetorno)},gerarDadosProprietario:function(a,o,r){var e,i=document.createElement("div");if(i.setAttribute("id",a.id+"-detalhe"),i.setAttribute("title","Dados do Proprietário"),r&&(i.setAttribute("class","row reportDetails"),$(i).append("<h5>Dados do Proprietário</h5>")),"PF"===o.tipoProprietario){if(null!=o.proprietarioPessoaFisica){var t=o.proprietarioPessoaFisica;e=linhaResult("4","Tipo","Pessoa Física","","4","CPF",NI(t.cpf),"","4","Nome",NI(t.nome),"","4","Número do RG",NI(t.numeroRg),"","4","Órgão Expeditor do RG",NI(t.orgaoExpedidorRg),"","4","Data do RG",t.dataRg,"","4","Nome do Pai",NI(t.nomePai),"","4","Nome da Mãe",NI(t.nomeMae),"","4","Data de Nascimento",t.dataNascimento,"","4","Sexo",NI(t.sexo),"","4","Estado Civil",NI(t.estadoCivil),"","4","País de Nascimento",NI(t.paisNascimento),"","4","Município de Nascimento - UF",NI(t.municipioNascimento)+" - "+NI(t.ufNascimento),"","4","Título de Eleitor",NI(t.tituloEleitor),"","4","Profissão",NI(t.profissao),"","4","Endereço",NI(t.endereco),"","4","Bairro",NI(t.bairro),"","4","Município - UF",NI(t.municipioEndereco)+" - "+NI(t.ufEndereco),"","4","CEP",Funcoes.formatarCep(t.cep),"","4","Telefone",NI(t.telefone),"","4","Empresa do Trabalho",NI(t.empresaTrabalho),"","4","Endereço do Trabalho",NI(t.enderecoTrabalho),"","4","Bairro do Trabalho",NI(t.bairroTrabalho),"","4","Município do Trabalho - UF",NI(t.municipioTrabalho)+"-"+NI(t.ufTrabalho),"","4","CEP do Trabalho",Funcoes.formatarCep(t.cepTrabalho),"","4","Telefone do Trabalho",NI(t.telefoneTrabalho),"","4","CGC do Trabalho",NI(t.cgcTrabalho),"")}}else null!=o.proprietarioPessoaJuridica&&(e=linhaResult("4","Tipo","Pessoa Jurídica","","8","Razão Social",o.proprietarioPessoaJuridica.razaoSocial,"","4","CNPJ",o.proprietarioPessoaJuridica.cnpj,"","4","Endereço",o.proprietarioPessoaJuridica.endereco,"","4","Bairro",o.proprietarioPessoaJuridica.bairro,"","4","Município - UF",o.proprietarioPessoaJuridica.municipioEndereco+" - "+o.proprietarioPessoaJuridica.ufEndereco,"","4","CEP",Funcoes.formatarCep(o.proprietarioPessoaJuridica.cep),"","4","Telefone",NI(o.proprietarioPessoaJuridica.telefone),""));$(i).append(e),$(a).append(i)}};$(function(){$("body").on("submit",".frm-filtro-armas",function(a){Armas.tratarSubmit(a,this)})});