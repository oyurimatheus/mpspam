var Siapen={usuarioPerfilInteligencia:!1,DEPEN_SPF:"DP",getFlag:function(a){return NuloOuVazio(a)?Siapen.DEPEN_SPF:a},isCargaDeEstado:function(a){return!NuloOuVazio(a)&&a!==Siapen.DEPEN_SPF},carregarUnidadesPenais:function(){genericRequest(SiapenProxy.getUnidadesPenais,null,Siapen.carregarUnidadesPenaisOk,"global-message")},carregarUnidadesPenaisOk:function(a){var e='<option selected="selected" value="0">Selecione</option>';if(null!==a.payload)for(var i=0;i<a.payload.length;i++)e+="<option value='"+a.payload[i].id+"'>"+a.payload[i].nome+"</option>";$("#slct-unidade-penal").html(e)},listarFiltro:function(a,e,i,t){var o=[];if(!0===a.success){if(Filtro.limparListagemConteudo(t),null!=a.payload&&0<a.payload.length){$("#"+t).data("registros",a.payload);for(var n=$("#"+t+"-nome").val(),s=$("#"+t+"-cpf").val(),r=$("#"+t+"-filiacao").val(),l=$("#"+t+"-dataNascimento").val(),d=$("#"+t+"-status").val(),c=0;c<a.payload.length;c++)Filtro.filtrarString(n,a.payload[c].nome)&&Filtro.filtrarString(limparCpf(s),limparCpf(a.payload[c].cpf))&&(Filtro.filtrarString(r,a.payload[c].nomeMae)||Filtro.filtrarString(r,a.payload[c].nomePai))&&Filtro.filtrarString(l,a.payload[c].dataNascimento)&&Filtro.filtrarStatusAtivo(d,a.payload[c].status)&&o.push(a.payload[c]);0<o.length&&Filtro.paginarRegistrosFiltrados(t,10,o,Siapen.gerarDadosBasicos),Report.showOrHideCheckboxAll(t)}Filtro.mostrarMensagemFiltro(t,a.msgRetorno,o.length)}else Filtro.mostrarMensagemFiltroInsucesso(t,a.msgRetorno)},consultarInternosOk:function(a,e,i,t,o,n){var s=document.getElementById(t+"-lista-conteudo");if(null===s?(criarEstruturaListagemResultados(t),s=document.getElementById(t+"-lista-conteudo")):$(s).empty(),!0===a.success){if(null!=a.payload&&0<a.payload.length){!1!==n&&($("#"+t).data("parameters",o),Counters.counterAdd(t,COD_SERVICO.SRV_SIAPEN,a.totalRegistros));for(var r=0;r<a.payload.length;r++){var l=t+"-"+r;Siapen.gerarDadosBasicos(s,a.payload[r],l,!1)}Report.showOrHideCheckboxAll(t)}}else gerarMensagemInsucesso(s,a.msgRetorno);if(n){10<a.totalRegistros&&Filtro.gerarBotaoDeFiltro(t,Siapen.gerarFormularioDeFiltro,COD_SERVICO.SRV_SIAPEN,a.totalRegistros),paginarListagemResultados(t,o,a.totalRegistros,SiapenProxy.getInternos,Siapen.consultarInternosOk,10,!1)}},consultarDetalheInternoOk:function(a,e,i,t){var o=document.getElementById(t),n=$(o).parent();!0===a.success?null!=a.payload&&(Siapen.gerarDadosDetalhe(n,a.payload,t),$(o).find(".row:eq(0)").find("div").first().find("p").off("click"),$(o).find(".row:eq(0)").find("div").first().find("p").on("click",function(){util.popOverSubEl(o.id,o.id+"-detalhe")}),util.popOverSubEl(t,t+"-detalhe")):gerarMensagemInsucesso(o,a.msgRetorno)},gerarDadosBasicos:function(a,e,i,t){var o=document.createElement("div");o.setAttribute("id",i),Report.checkbox(o,e.id,COD_SERVICO.SRV_SIAPEN,e);var n=Siapen.dadosBasicos(e,!1);$(o).append(n),$(a).append(o),t?$(o).find(".row:eq(0)").find("div").first().find("p").on("click",function(){util.popOverSubEl(o.id,o.id+"-detalhe")}):$(o).find(".row:eq(0)").find("div").first().find("p").on("click",function(){Siapen.realizarBuscaDetalhes(e.id,o)})},gerarDadosDetalhe:function(a,e,i){var t=document.createElement("div");t.setAttribute("id",i+"-detalhe"),t.setAttribute("hidden",""),t.setAttribute("title","Detalhes do Interno");var o="tab-"+i+"-detalhe",n="tab-"+i+"-advogados",s="tab-"+i+"-visitantes",r="tab-"+i+"-visitas",l="tab-"+i+"-transferencias",d='<div><ul id="ul-tab-det-'+i+'" class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#'+o+'">Detalhe</a></li>';Siapen.usuarioPerfilInteligencia&&(Siapen.isCargaDeEstado(e.ufArquivoCarga)||(d=d+'<li><a data-toggle="tab" href="#'+n+'">Advogados</a></li><li><a data-toggle="tab" href="#'+s+'">Visitantes</a></li><li><a data-toggle="tab" href="#'+r+'">Visitas</a></li>'),d=d+'<li><a data-toggle="tab" href="#'+l+'">Transferências</a></li>'),d=d+'</ul><div id="ul-tab-det-content-'+i+'" class="tab-content"><div id="'+o+'" class="tab-pane fade in active"></div>',Siapen.usuarioPerfilInteligencia&&(Siapen.isCargaDeEstado(e.ufArquivoCarga)||(d=d+'<div id="'+n+'" class="tab-pane fade in"></div><div id="'+s+'" class="tab-pane fade in list"></div><div id="'+r+'" class="tab-pane fade in list"></div>'),d=d+'<div id="'+l+'" class="tab-pane fade in list"></div>'),d+="</div><div>",$(t).append(d),$(a).append(t);var c=document.getElementById(o);Report.checkboxDetails(c,e.id,COD_SERVICO.SRV_SIAPEN,e),$(c).append(Siapen.dadosDetalhados(e,!1)),Siapen.usuarioPerfilInteligencia&&(Siapen.isCargaDeEstado(e.ufArquivoCarga)||($('a[href="#'+n+'"]').one("click",function(){Siapen.realizarBuscaComplementar(SiapenProxy.getAdvogados,Siapen.consultarAdvogadosOk,n,e.id)}),$('a[href="#'+s+'"]').one("click",function(){Siapen.realizarBuscaComplementar(SiapenProxy.getVisitantes,Siapen.consultarVisitantesOk,s,e.id)}),$('a[href="#'+r+'"]').one("click",function(){Siapen.realizarBuscaComplementar(SiapenProxy.getVisitas,Siapen.consultarVisitasOk,r,e.id)})),$('a[href="#'+l+'"]').one("click",function(){Siapen.realizarBuscaComplementar(SiapenProxy.getTransferencias,Siapen.consultarTransferenciasOk,l,e.id)}))},realizarBuscaComplementar:function(a,e,i,t){genericRequest(a,{id:t},e,i)},consultarAdvogadosOk:function(a,e,i,t,o){var n=document.getElementById(t);!0===a.success&&null!=a.payload?(Report.checkboxDetails(n,o.id,COD_SERVICO.SRV_SIAPEN,a.payload,"SA"),$(n).append(Siapen.dadosAdvogados(t,a.payload,!1))):gerarMensagemInsucesso(n,a.msgRetorno)},consultarVisitantesOk:function(a,e,i,t,o){var n=document.getElementById(t);!0===a.success&&null!=a.payload?(Report.checkboxDetails(n,o.id,COD_SERVICO.SRV_SIAPEN,a.payload,"SP"),$(n).append(Siapen.dadosVisitantes(a.payload,!1))):gerarMensagemInsucesso(n,a.msgRetorno)},consultarVisitasOk:function(a,e,i,t,o){var n=document.getElementById(t);!0===a.success&&null!=a.payload?(Report.checkboxDetails(n,o.id,COD_SERVICO.SRV_SIAPEN,a.payload,"SV"),$(n).append(Siapen.dadosVisitas(a.payload,!1))):gerarMensagemInsucesso(n,a.msgRetorno)},consultarTransferenciasOk:function(a,e,i,t,o){var n=document.getElementById(t);!0===a.success&&null!=a.payload?(Report.checkboxDetails(n,o.id,COD_SERVICO.SRV_SIAPEN,a.payload,"ST"),$(n).append(Siapen.dadosTransferencias(a.payload,!1))):gerarMensagemInsucesso(n,a.msgRetorno)},realizarBuscaDetalhes:function(a,e){var i={id:a};genericRequest(SiapenProxy.getInterno,i,Siapen.consultarDetalheInternoOk,e.id)},reportItem:function(a,e,i){var t=document.createElement("div");t.setAttribute("id",i);var o=Siapen.dadosBasicos(e,!0);$(t).append(o),$(a).append(t),$(t).find(".row:eq(0)").find("div").first().find("p").on("click",function(){Siapen.realizarBuscaDetalhesParaAdicionarNoRelatorio(e.id,t)})},reportItemDetalhe:function(a,e,i){var t=document.createElement("div");t.setAttribute("id",i);var o=Siapen.dadosDetalhados(e,!0);Siapen.usuarioPerfilInteligencia&&(Siapen.isCargaDeEstado(e.ufArquivoCarga)||(o+=Siapen.dadosAdvogados(i,e.advogados,!0),o+=Siapen.dadosVisitantes(e.visitantes,!0),o+=Siapen.dadosVisitas(e.visitas,!0)),o+=Siapen.dadosTransferencias(e.transferencias,!0)),o=resultDiv(o),$(t).append(o),$(a).append(t)},dadosBasicos:function(a,e){var i="";"ATIVO"===a.status.toUpperCase()&&(i=" sinesp-notification-alert");var t=colunaResultComBandeira("3","Nome",a.nome,Siapen.getFlag(a.ufArquivoCarga)),o=colunasResult("3","Filiação",Funcoes.filiacao(a.nomeMae,a.nomePai,e),"","2","CPF",e?formatarCpf(a.cpf):Funcoes.link(formatarCpf(a.cpf)),"","2","D. N.",NI(a.dataNascimento),"Data de Nascimento","2"+i,"Status",NI(a.status),"");return resultDiv(t+o)},dadosDetalhados:function(a,e){var i=[],t="";NuloOuVazio(a.apelido)||i.push(a.apelido),NuloOuVazio(a.outroNome)||i.push(a.outroNome);var o="";return"ATIVO"===a.status.toUpperCase()&&(o=" sinesp-notification-alert"),e&&(t=colunaResultComBandeira("4","Nome",a.nome,Siapen.getFlag(a.ufArquivoCarga))),t+=colunasResult("4","Mãe",e?NI(a.nomeMae):Funcoes.linkGenitora(NI(a.nomeMae)),"","4","CPF",e?formatarCpf(a.cpf):Funcoes.link(formatarCpf(a.cpf)),"","4","D. N.",NI(a.dataNascimento),"Data de Nascimento","4"+o,"Status",NI(a.status),"","4","Pai",e?NI(a.nomePai):Funcoes.linkGenitor(NI(a.nomePai)),"","4","Alcunhas",NI(i.join(", ")),"","4","Nome Facção",NI(a.nomeFaccao),"","4","Profissão",NI(a.profissao),"","4","RG",NI(a.rg),"","4","Estado Civil",NI(a.estadoCivil),"","4","Peso",NI(a.peso),"","4","Altura",NI(a.altura),"","4","Sinais Particulares",NI(a.sinaisParticulares),"","4","Cor dos Olhos",NI(a.corOlhos),"","4","Raça",NI(a.raca),"","4","Endereço",NI(a.endereco),"","4","Naturalidade",NI(a.naturalidade),"","4","Nacionalidade",NI(a.nacionalidade),"","4","Telefone",NI(a.telefone),"","4","UF Solicitante",NI(a.ufSolicitanteVaga),"","8","Unidade Penal",NI(a.nomeUnidadePenal),""),t=resultDiv(Siapen.dadosImagemInterno(a.id)+t),t+=Siapen.dadosDeficiencias(a.deficiencias),t='<div class="list row">'+(t+=Siapen.dadosUnidadePenal(a.unidadePenal,"Unidade Penal"))+"</div>"},dadosDeficiencias:function(a){var e="";if(null!=a&&0<a.length){for(var i=0;i<a.length;i++){var t=a[i];e+=linhaResult("4","Descrição",NI(t.descricao),"","4","Parte do Corpo Afetada",NI(t.membroAfetado),"","4","Motivo",NI(t.motivo),"","4","Tipo de Atrofia",NI(t.tipoAtrofia),"","4","Tipo de Locomoção",NI(t.tipoLocomocao),"")}e=Funcoes.criarTituloLista("Deficiências",e)}return e},dadosUnidadePenal:function(a,e){var i="";return null!=a&&(i=linhaResult("6","Nome",NI(a.nome),"","3","Sigla",NI(a.sigla),"","3","Telefone",NI(a.numTelefone),"","9","Endereço",NI(a.endereco),"","3","Fax",NI(a.numFax),""),i=Funcoes.criarTituloItem(e,i)),i},dadosAdvogados:function(a,e,i){var t="",o=[];if(null!=e&&0<e.length){for(var n=0;n<e.length;n++){var s=e[n].advogado,r=[];r.push(NI(s.nome)),r.push(NI(s.registroOAB)),r.push(NI(e[n].observacao)),r.push(NI(e[n].dataConstituicaoAdvogado)),r.push(NI(e[n].dataDesconstituicaoAdvogado)),r.push(NI(e[n].statusVinculo)),o.push(r)}t=Funcoes.criarTabela(a,["Nome","OAB","Observação","Data Constituição","Data Desconstituição","Status"],["50","15","35","15","15","15"],o),i&&(t=Funcoes.criarTituloLista("Advogados",t))}else i||(t="Nenhum registro encontrado.");return t},dadosVisitantes:function(a,e){var i="";if(null!=a&&0<a.length){for(var t=0;t<a.length;t++){var o={statusVinculo:a[t].statusVinculo,dataAtivacaoVinculo:a[t].dataAtivacaoVinculoFormatada,dataInativacaoVinculo:a[t].dataInativacaoVinculoFormatada,observacao:a[t].observacaoVinculo};i+=Siapen.dadosVisitante(a[t].visitante,a[t].grauParentesco,o)}e&&(i=Funcoes.criarTituloLista("Visitantes",i))}else e||(i="Nenhum registro encontrado.");return i},dadosVisitante:function(a,e,i){var t="";return null!=a&&(t=colunasResult("5","Nome",NI(a.nome),"","4","CPF",NI(a.cpf),"","5","Mãe",NI(a.nomeMae),"","4","D. N.",NI(a.dataNascimento),"","5","Pai",NI(a.nomePai),"","4","RG",NI(a.rg),"","5","Data Emissão RG",NI(a.dataEmissaoRG),"","4","Sexo",NI(a.sexo),"","5","Naturalidade",NI(a.naturalidade),"","4","Nacionalidade",NI(a.nacionalidade),"","8","Endereço",NI(a.endereco),"","4","Telefone",NI(a.numTelefone),"","3","Status",NI(a.status),"","3","Tipo de Visitante",NI(a.tipoVisitante),"","3","Data da Última Visita",NI(a.dataUltimaVisita),"","3","Data de Cadastro",NI(a.dataCadastro),""),void 0!==e&&(t+=colunasResult("3","Grau de Parentesco",NI(e),"")),void 0!==i&&(t+=colunasResult("3","Status Vínculo",NI(i.statusVinculo),"","3","Data Ativação Vínculo",NI(i.dataAtivacaoVinculo),"","3","Data Inativação Vínculo",NI(i.dataInativacaoVinculo),"","10","Observação",NI(i.observacao))),t=resultDiv(Siapen.dadosImagemVisitante(a.id)+t)),t},dadosVisitas:function(a,e){var i="";if(null!=a&&0<a.length){for(var t=["Unidade Penal","Tipo da Visita","Datas das Visitas"],o=["45","15","40"],n=[],s=0;s<a.length;s++){var r=a[s],l={};n=[];for(var d=0;d<r.visitasRealizadas.length;d++){l[c=r.visitasRealizadas[d].nomeUnidadePenal+"-|-"+r.visitasRealizadas[d].tipoVisita]||(l[c]=[],l[c].nomeUnidadePenal=r.visitasRealizadas[d].nomeUnidadePenal,l[c].tipoVisita=r.visitasRealizadas[d].tipoVisita,l[c].datas=[]),l[c].datas.push(r.visitasRealizadas[d].dataVisita)}for(var c in l)if(l.hasOwnProperty(c)){var u=[];u.push(NI(l[c].nomeUnidadePenal)),u.push(NI(l[c].tipoVisita)),u.push(NI(l[c].datas.join(", "))),n.push(u)}i+=linhaResult("7","Nome do Visitante",NI(r.nome),"","3","CPF",NI(r.cpf),"","2","N&ordm; Visitas",r.numVisitas,"","1","","","","11","",Funcoes.criarTabela(s,t,o,n),"")}e&&(i=Funcoes.criarTituloLista("Visitas",i))}else e||(i="Nenhum registro encontrado.");return i},dadosTransferencias:function(a,e){var i="";if(null!=a&&0<a.length){for(var t=0;t<a.length;t++){var o=a[t];i+=linhaResult("2","Data",NI(o.dataTransferencia),"","5","Unidade Penal de Origem",NI(o.nomeUnidadePenalOrigem),"","5","Unidade Penal de Destino",NI(o.nomeUnidadePenalDestino),"")}e&&(i=Funcoes.criarTituloLista("Transferências",i))}else e||(i="Nenhum registro encontrado.");return i},realizarBuscaDetalhesParaAdicionarNoRelatorio:function(e,i){util.confirm("Confirma a inclusão do detalhamento do item no relatório?").done(function(){var a={id:e};genericRequest(SiapenProxy.getInterno,a,Siapen.consultarDetalhesParaAdicionarNoRelatorioOk,i.id)}).fail()},consultarDetalhesParaAdicionarNoRelatorioOk:function(a,e,i,t){Report.adicionaDetalhamentoItem(a,t,COD_SERVICO.SRV_SIAPEN,"id")},dadosImagemInterno:function(a){return Siapen.exibirImagem("/infoseg2-service-siapen/api/internos/foto/",a,"4")},dadosImagemVisitante:function(a){return Siapen.exibirImagem("/infoseg2-service-siapen/api/visitantes/foto/",a,"3")},exibirImagem:function(a,e,i){var t="";return null!=e&&(t='<div class="col-md-'+i+'"><div class="fotoBox"><img src="'+urlServico+a+e+'" onError="this.onerror=null;this.src=\'img//fotobox_bkg.png\';"></div></div>'),t},gerarFormularioDeFiltro:function(a,e){$(e).off("click");var i=$("<div class='sinesp-dropdown-menu sinesp-popover text-left'><form id='frm-"+a+"' class='form frm-filtro-siapen' novalidate><input type='hidden' value='"+a+"' name='chave'/><div class='row sinesp-filter-row-small'><div class='col-md-12'><div class='form-group'><label>Nome</label><input type='text' class='form-control' id='"+a+"-nome' maxlength='100' /></div><div class='form-group'><label>Filiação</label><input type='text' class='form-control' id='"+a+"-filiacao' maxlength='100' /></div><div class='form-group'><label>Data de Nascimento</label><input type='text' class='form-control' id='"+a+"-dataNascimento' maxlength='10'  onkeypress='return Funcoes.isDataDigitada(event)'/></div><div class='form-group'><label>CPF</label><input type='text' class='form-control' id='"+a+"-cpf' maxlength='11'  onkeypress='return Funcoes.isNumeroDigitado(event)'/></div><div class='form-group'><label>Status</label><select class='form-control' id='"+a+"-status'><option value=''></option><option value='A'>ATIVO</option><option value='I'>INATIVO</option></select></div><div class='form-group text-right'><button id='"+a+"-btn-limpar-formulario' class='btn btn-primary' type='button' onclick='Filtro.limparFormulario(this.form)'>Limpar</span></button>&nbsp;&nbsp;&nbsp;<button id='"+a+"-btn-filtrar-pesquisa' type='submit' class='btn btn-primary' >Filtrar &nbsp; <span class='glyphicon glyphicon-search'></span></button></div></div></div></form></div>");$("#"+a+"-lista-filtro").append(i)},verificarSubItem:function(a,e){var i=reportValues[a];switch(e){case SUB_TIPO_SERVICO.SIAPEN_ADVOGADOS:return null!=i.payload.advogados&&0<i.payload.advogados.length;case SUB_TIPO_SERVICO.SIAPEN_VISITANTES:return null!=i.payload.visitantes&&0<i.payload.visitantes.length;case SUB_TIPO_SERVICO.SIAPEN_VISITAS:return null!=i.payload.visitas&&0<i.payload.visitas.length;case SUB_TIPO_SERVICO.SIAPEN_TRANSFERENCIAS:return null!=i.payload.transferencias&&0<i.payload.transferencias.length}}};$(function(){$("body").on("submit",".frm-filtro-siapen",function(a){Filtro.tratarSubmit(a,this,SiapenProxy.getInternosFiltro,Siapen.listarFiltro)})});