var Desaparecidos={consultarDesaparecidosOk:function(a,e,o,i,r,t){var s=document.getElementById(i+"-lista-conteudo");if(null===s?(criarEstruturaListagemResultados(i),s=document.getElementById(i+"-lista-conteudo")):$(s).empty(),!0===a.success){if(null!=a.payload&&0<a.payload.length){!1!==t&&($("#"+i).data("parameters",r),Counters.counterAdd(i,COD_SERVICO.SRV_DESAPARECIDOS,a.totalRegistros));for(var l=0;l<a.payload.length;l++){var n=i+"-"+l,d=a.payload[l];Desaparecidos.gerarDadosBasicosEDetalhados(s,d,n)}Report.showOrHideCheckboxAll(i)}}else gerarMensagemInsucesso(s,a.msgRetorno);if(t){10<a.totalRegistros&&Filtro.gerarBotaoDeFiltro(i,Desaparecidos.gerarFormularioDeFiltro,COD_SERVICO.SRV_DESAPARECIDOS,a.totalRegistros),paginarListagemResultados(i,r,a.totalRegistros,DesaparecidosProxy.getDesaparecidos,Desaparecidos.consultarDesaparecidosOk,10,!1)}},consultarDesaparecidosFiltroOk:function(a,e,o,i){var r=[];if(!0===a.success){if(Filtro.limparListagemConteudo(i),null!=a.payload&&0<a.payload.length){$("#"+i).data("registros",a.payload);for(var t=$("#"+i+"-nome").val(),s=$("#"+i+"-filiacao").val(),l=$("#"+i+"-dataDeNascimento").val(),n=$("#"+i+"-processo").val(),d=$("#"+i+"-municipio").val(),c=0;c<a.payload.length;c++)Filtro.filtrarString(t,a.payload[c].nome)&&(Filtro.filtrarString(s,a.payload[c].nomeMae)||Filtro.filtrarString(s,a.payload[c].nomePai))&&Filtro.filtrarString(l,formatarData(a.payload[c].dataNascimento))&&Filtro.filtrarString(n,a.payload[c].numeroProcesso)&&(Filtro.filtrarString(d,a.payload[c].municipio)||Filtro.filtrarString(d,a.payload[c].ufMunicipio))&&r.push(a.payload[c]);0<r.length&&Filtro.paginarRegistrosFiltrados(i,10,r,Desaparecidos.gerarDadosBasicosEDetalhados),Report.showOrHideCheckboxAll(i)}Filtro.mostrarMensagemFiltro(i,a.msgRetorno,r.length)}else Filtro.mostrarMensagemFiltroInsucesso(i,a.msgRetorno)},gerarDadosBasicosEDetalhados:function(a,e,o){Desaparecidos.gerarDadosBasicosDesaparecidos(a,e,o),Desaparecidos.gerarDadosDetalhadosDesaparecidos(a,e,o)},gerarDadosBasicosDesaparecidos:function(a,e,o){var i=document.createElement("div");i.setAttribute("id",o),Report.checkbox(i,e.ufGeradora+"-#-"+e.pessoaId,COD_SERVICO.SRV_DESAPARECIDOS,e);var r=Desaparecidos.dadosBasicosDesaparecido(e,!1);$(i).append(r),$(a).append(i),$(i).find(".row:eq(0)").find("div").first().find("p").on("click",function(){util.popOverSubEl(i.id,i.id+"-detalhe")})},dadosBasicosDesaparecido:function(a,e){var o=colunaResultComBandeira("3","Nome",a.nome,NI(a.ufGeradora)),i=colunasResult("3","Filiação",Funcoes.filiacao(a.nomeMae,a.nomePai,e),"","1","D. N.",formatarData(a.dataNascimento),"","2","Nº Processo",NI(a.numeroProcesso),"","3","Município - UF",NI(a.municipio)+" - "+NI(a.ufMunicipio),"");return resultDiv(o+i)},gerarDadosDetalhadosDesaparecidos:function(a,e,o){var i=document.createElement("div");i.setAttribute("id",o+"-detalhe"),i.setAttribute("hidden",""),i.setAttribute("title","Detalhes do Desaparecido");var r=document.createElement("div");r.setAttribute("id",o+"-dadosdesaparecidos"),r.setAttribute("class","tab-pane fade in active"),Report.checkboxDetails(i,e.ufGeradora+"-#-"+e.pessoaId,COD_SERVICO.SRV_DESAPARECIDOS,e);var t=Desaparecidos.dadosDetalheDesaparecido(e,!1);$(r).append(t),$(i).append(r),$(a).append(i),Desaparecidos.criarCarousel(r.id,e.imagens)},dadosDetalheDesaparecido:function(a,e){var o=(NuloOuVazio(a.tipoLogradouro)?"":a.tipoLogradouro+" ")+(NuloOuVazio(a.logradouro)?"":a.logradouro+" ")+(NuloOuVazio(a.edificacao)?"":a.edificacao+" ")+(NuloOuVazio(a.complemento)?"":", "+a.complemento),i=e?colunaResultComBandeira("5","Nome",a.nome,NI(a.ufGeradora)):"";i+=colunasResult("5","Mãe",e?NI(a.nomeMae):Funcoes.linkGenitora(NI(a.nomeMae)),"","5","Pai",e?NI(a.nomePai):Funcoes.linkGenitor(NI(a.nomePai)),"","2","D. N.",formatarData(a.dataNascimento),"","2","Idade (desap.)",NI(a.idade),"","2","Tel. de Contato",NI(a.telefoneContato),"","8","Endereço",NI(o),"","4","Bairro",NI(a.bairro),"","6","Município - UF",NI(a.municipio)+" - "+NI(a.ufMunicipio),"","2","CEP",Funcoes.formatarCep(a.cep),"");var r='<div class="list reportDetails"><h5>Dados da Ocorrência</h5>'+linhaResult("4","Órgão",NI(a.unidadeId)+", "+NI(a.nomeUnidade),"","2","Nº Processo",NI(a.numeroProcesso),"","3","Nº Processo Titular",NI(a.numeroProcessoPai),"","3","Data Desaparecimento",Desaparecidos.exibirDataDesaparecimento(a.dataFatoFormatada,a.dataIncerta),"","12","Relato da Ocorrência",NI(a.relatoOcorrencia),"","6","Local do Fato",NI(a.detalheLocalFato),"","4","Fornecida/Atualizada",NI(a.dataAlteracaoOrigemFormatada),"")+"</div>";return resultDiv(i)+r},exibirDataDesaparecimento:function(a,e){var o=NI(a);return null!=e&&0<e.length&&(o="N/I"===o?e:o+" - "+e),o},reportItem:function(a,e,o){var i=document.createElement("div");i.setAttribute("id",o);var r=Desaparecidos.dadosBasicosDesaparecido(e,!0);$(i).append(r),$(a).append(i),$(i).find(".row:eq(0)").find("div").first().find("p").on("click",function(){Desaparecidos.adicionarDetalheNoRelatorio(e,i)})},reportItemDetalhe:function(a,e,o){var i=document.createElement("div");i.setAttribute("id",o);var r=Desaparecidos.dadosDetalheDesaparecido(e,!0);null!=e.imagens&&Desaparecidos.gerarFotosRelatorio(i,e.imagens),$(i).prepend(r),$(a).append(i)},gerarFotosRelatorio:function(a,e){if(0<e.length){var o=urlServico+"/infoseg2-service-desaparecidos/api/desaparecidos",i=document.createElement("div");i.setAttribute("class","row reportPhotos");for(var r=0;r<e.length;r++){var t=$("<div class='col-md-3'><div><img src="+o+"/imagem/"+e[r].nomeArquivo+" onError=\"this.onerror=null;this.src='img/carousel/foto_background.png';\" /></div></div>");$(i).append(t)}$(a).append(i)}},adicionarDetalheNoRelatorio:function(a,e){util.confirm("Confirma a inclusão do detalhamento do item no relatório?").done(function(){$(e).find(".row:eq(0)").find("div").first().find("p").off("click"),e.setAttribute("data-servico",COD_SERVICO.SRV_DESAPARECIDOS),e.setAttribute("data-key",a.ufGeradora+"-#-"+a.pessoaId),e.setAttribute("data-tipo","R"),e.setAttribute("data-parent-id",e.id),$(e).data("payload",a),Report.addItemReport(e)}).fail()},criarCarousel:function(a,e){if(null!=e&&0<e.length){var o=urlServico+"/infoseg2-service-desaparecidos/api/desaparecidos",i='<div id="'+a+'-carousel" class="carousel slide " data-ride="carousel">';i+='<div class="carousel-inner" role="listbox">';for(var r=0;r<e.length;r++)i+=0===r?'<div class="item active"><span class="lazy-load-foto"><img class="img-responsive center-block" src="'+o+"/imagem/"+e[r].nomeArquivo+'" onError="this.onerror=null;this.src=\'img/carousel/foto_background.png\';"></span></div>':'<div class="item"><span class="lazy-load-foto"><img class="img-responsive center-block" data-lazy-load-src="'+o+"/imagem/"+e[r].nomeArquivo+'" onError="this.onerror=null;this.src=\'img/carousel/foto_background.png\';"></span></div>';i+="</div>",1<e.length&&(i+='<a class="left carousel-control" href="#'+a+'-carousel" data-slide="prev"><span class="glyphicon glyphicon-chevron-left"></span></a><a class="right carousel-control" href="#'+a+'-carousel" data-slide="next"><span class="glyphicon glyphicon-chevron-right"></span></a>'),i+="</div>",$("#"+a).prepend('<div class="sinesp-popover-photo-carousel">'+i+"</div>"),$("#"+a+"-carousel").carousel({interval:!1});var t=0;$("#"+a+"-carousel").on("slide.bs.carousel",function(a){$activeItem=$(".active.item",this),0===t&&(t=$(this).height(),$activeItem.next(".item").height(t)),$(a.relatedTarget).find("img").each(function(){var a=$(this).data("lazy-load-src");void 0!==a&&""!==a&&($(this).attr("src",a),$(this).data("lazy-load-src",""))})})}},gerarFormularioDeFiltro:function(a,e){$(e).off("click");var o=$("<div class='sinesp-dropdown-menu sinesp-popover text-left'><form id='frm-"+a+"' class='form frm-filtro-desaparecidos' novalidate><input type='hidden' value='"+a+"' name='chave'/><div class='row sinesp-filter-row-big'><div class='col-md-12'><div class='form-group'><label>Nome</label><input type='text' class='form-control' id='"+a+"-nome' maxlength='100' /></div><div class='form-group'><label>Filiação</label><input type='text' class='form-control' id='"+a+"-filiacao' maxlength='100' /></div></div><div class='col-md-12'><div class='form-group'><label>Data de Nascimento</label><input type='text' class='form-control' id='"+a+"-dataDeNascimento' maxlength='10'  onkeypress='return Funcoes.isDataDigitada(event)'/></div></div><div class='col-md-12'><div class='form-group'><label>N&ordm; Processo</label><input type='text' class='form-control' id='"+a+"-processo' maxlength='100' /></div></div><div class='col-md-12'><div class='form-group'><label>Município - UF</label><input type='text' class='form-control' id='"+a+"-municipio' maxlength='100' /></div></div><div class='col-md-12 text-right'><div class='form-group'><button id='"+a+"-btn-limpar-formulario' class='btn btn-primary' type='button' onclick='Filtro.limparFormulario(this.form)'>Limpar</span></button> &nbsp;&nbsp;&nbsp;<button id='"+a+"-btn-filtrar-pesquisa' type='submit' class='btn btn-primary'>Filtrar &nbsp; <span class='glyphicon glyphicon-search'></span></button></div></div></div></form></div>");$("#"+a+"-lista-filtro").append(o)}};$(function(){$("body").on("submit",".frm-filtro-desaparecidos",function(a){Filtro.tratarSubmit(a,this,DesaparecidosProxy.getDesaparecidosFiltro,Desaparecidos.consultarDesaparecidosFiltroOk)})});