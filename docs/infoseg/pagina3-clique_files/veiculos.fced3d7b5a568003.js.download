var Veiculos={indicePagVeiculos:[],listarFiltro:function(o,a,e,i){var r=[];if(!0===o.success){if(Filtro.limparListagemConteudo(i),null!=o.payload&&0<o.payload.length){$("#"+i).data("registros",o.payload);for(var t=$("#"+i+"-placa").val(),c=$("#"+i+"-descricaoMunicipioEmplacamento").val(),d=$("#"+i+"-descricaoMarcaModelo").val(),l=$("#"+i+"-descricaoCor").val(),s=document.getElementById(i+"-ufJurisdicao"),n=0<s.selectedIndex?s.options[s.selectedIndex].value:"",u=document.getElementById(i+"-indicadorRouboFurto"),m=0<u.selectedIndex?u.options[u.selectedIndex].value:"",p=0;p<o.payload.length;p++)Filtro.filtrarString(t,o.payload[p].placa)&&Filtro.filtrarString(c,o.payload[p].descricaoMunicipioEmplacamento)&&Filtro.filtrarString(d,o.payload[p].descricaoMarcaModelo)&&Filtro.filtrarString(l,o.payload[p].descricaoCor)&&Filtro.filtrarString(n,o.payload[p].ufJurisdicao)&&Filtro.filtrarBoolean(m,o.payload[p].indicadorRouboFurto)&&r.push(o.payload[p]);0<r.length&&Filtro.paginarRegistrosFiltrados(i,15,r,Veiculos.gerarItemListaEDetalhe),Report.showOrHideCheckboxAll(i)}Filtro.mostrarMensagemFiltro(i,o.msgRetorno,r.length)}else Filtro.mostrarMensagemFiltroInsucesso(i,o.msgRetorno)},listar:function(o,a,e,i,r,t,c){Funcoes.consoleLogResult("Veiculos.listar",o,a,e);var d=document.getElementById(i+"-lista-conteudo");if(null===d?(criarEstruturaListagemResultados(i),d=document.getElementById(i+"-lista-conteudo")):$(d).empty(),!0===o.success){if(null!=o.payload&&0<o.payload.length){!1!==t&&($("#"+i).data("parameters",r),Counters.counterAdd(i,COD_SERVICO.SRV_VEICULOS,o.totalRegistros),Veiculos.indicePagVeiculos[i]=[],Veiculos.indicePagVeiculos[i].push(0));var l=Veiculos.indicePagVeiculos[i];-1===l.indexOf(o.ultimoRegistro)&&l.push(o.ultimoRegistro);for(var s=0;s<o.payload.length;s++){var n=i+"-"+s,u=o.payload[s];Veiculos.gerarItemLista(d,u,n),Veiculos.gerarItemDetalhe(d,u,n)}Report.showOrHideCheckboxAll(i)}}else gerarMensagemInsucesso(d,o.msgRetorno);t?Veiculos.paginar(i,r,o.totalRegistros,c,Veiculos.listar):Funcoes.mudarAtivacaoPaginacao(i,!0)},paginar:function(i,r,o,t,c){var a=$("<div id='"+i+"-pag'/>");$("#"+i+"-lista-conteudo").after(a);var e=parseInt(o/15);0<o%15&&(e+=1),1<e&&(Filtro.gerarBotaoDeFiltro(i,Veiculos.gerarFormularioDeFiltro,COD_SERVICO.SRV_VEICULOS,o),$("#"+i+"-pag").attr("totalpaginas",e),$(a).bootpag({total:e,page:1,maxVisible:1,leaps:!1}).on("page",function(o,a){o.preventDefault(),Report.setStateCheckboxAll(i,!1);var e=Veiculos.indicePagVeiculos[i];e.length>a-1&&(Funcoes.mudarAtivacaoPaginacao(i,!1),r.ultimoRegistro=e[a-1],genericRequest(t,r,c,i,!1))}))},gerarItemListaEDetalhe:function(o,a,e){Veiculos.gerarItemLista(o,a,e),Veiculos.gerarItemDetalhe(o,a,e)},gerarItemLista:function(o,a,e){var i=document.createElement("div");i.setAttribute("id",e),Report.checkbox(i,a.placa,COD_SERVICO.SRV_VEICULOS,a);var r=Veiculos.dadosBasicos(a,!1);$(i).append(r),$(o).append(i),$(i).find(".row:eq(0)").find("div").first().find("p").on("click",function(){util.popOverSubEl(i.id,i.id+"-detalhe")})},reportItem:function(o,a,e){var i=document.createElement("div");i.setAttribute("id",e);var r=Veiculos.dadosBasicos(a,!0);$(i).append(r),$(o).append(i),$(i).find(".row:eq(0)").find("div").first().find("p").on("click",function(){Veiculos.realizarBuscaDetalhesVeiculoParaAdicionarNoRelatorio(a.placa,i)})},realizarBuscaDetalhesVeiculoParaAdicionarNoRelatorio:function(a,e){util.confirm("Confirma a inclusão do detalhamento do item no relatório?").done(function(){var o={placa:a};genericRequest(VeiculosProxy.getVeiculoPorPlaca,o,Veiculos.consultarDetalhesVeiculoParaAdicionarNoRelatorioOk,e.id)}).fail()},consultarDetalhesVeiculoParaAdicionarNoRelatorioOk:function(o,a,e,i){Report.adicionaDetalhamentoItem(o,i,COD_SERVICO.SRV_VEICULOS,"placa")},dadosBasicos:function(o,a){var e="";return isTrue(o.indicadorRouboFurto)&&(e=" sinesp-notification-alert"),linhaResult("1","Placa",o.placa,"","2","Município - UF",o.descricaoMunicipioEmplacamento+" - "+o.ufJurisdicao,"","2","Marca/Modelo",o.descricaoMarcaModelo,"","2","Cor",NI(o.descricaoCor),"","2","Ano Fabricação/Ano Modelo",o.anoFabricacao+"/"+o.anoModelo,"","2","CPF/CNPJ do Proprietário",a?NI(o.numeroIdentificacaoProprietario):Funcoes.link(NI(o.numeroIdentificacaoProprietario)),"","1"+e,"Roubo/Furto",SimNao(o.indicadorRouboFurto),"")},reportItemDetalhe:function(o,a,e){var i=document.createElement("div");i.setAttribute("id",e);var r=Veiculos.dadosDetalhe(a,!0);r+='<div class="reportDetails"><h5>Documento do Veículo</h5>'+Veiculos.dadosDocumento(a,!0)+"</div>",null!=a.enderecoPossuidor&&(r+='<div class="reportDetails"><h5>Endereço do Possuidor</h5>'+Veiculos.dadosEnderecoPossuidor(a.enderecoPossuidor)+"</div>"),$(i).append(r),$(o).append(i)},gerarItemDetalhe:function(o,a,e){var i=document.createElement("div");i.setAttribute("id",e+"-detalhe"),i.setAttribute("hidden",""),i.setAttribute("title","Detalhes do Veículo"),Report.checkboxDetails(i,a.placa,COD_SERVICO.SRV_VEICULOS,a);var r=Veiculos.dadosDetalhe(a,!1),t=Veiculos.dadosDocumento(a,!1),c="tab-"+e+"-detalhesVeiculo",d="tab-"+e+"-documentoVeiculo",l="tab-"+e+"-enderecoPossuidor",s='<div><ul id="ul-tab-det-'+e+'" class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#'+c+'">Detalhes do Veículo</a></li><li><a data-toggle="tab" href="#'+d+'">Documento do Veículo</a></li><li><a data-toggle="tab" href="#'+l+'">Endereço do Possuidor</a></li></ul><div id="ul-tab-det-content-'+e+'" class="tab-content"><div id="'+c+'" class="tab-pane fade in active">'+r+'</div><div id="'+d+'" class="tab-pane fade in">'+t+'</div><div id="'+l+'" class="tab-pane fade in"></div></div><div>';$(i).append(s),$(o).append(i),$('a[href="#'+l+'"]').one("click",function(){Veiculos.realizarBuscaEnderecoPossuidor(VeiculosProxy.getEnderecoPossuidor,Veiculos.consultarEnderecoPossuidorOk,l,a.placa,a.codigoRenavam)})},realizarBuscaEnderecoPossuidor:function(o,a,e,i,r){genericRequest(o,{placa:i,renavam:r},a,e)},consultarEnderecoPossuidorOk:function(o,a,e,i){var r=document.getElementById(i);!0===o.success&&null!=o.payload?$(r).append(Veiculos.dadosEnderecoPossuidor(o.payload)):gerarMensagemInsucesso(r,o.msgRetorno)},dadosEnderecoPossuidor:function(o){return linhaResult("4","Nome",NI(o.nomePossuidor),"","4","Origem Possuidor",NI(o.descricaoOrigemPossuidor),"","4","Documento Possuidor",NI(o.descricaoDocumentoPosssuidor),"","4","Nº Documento",NI(o.numeroDocumentoPossuidor),"","4","Endereço, nº",NI(o.enderecoLogradouro)+", "+NI(o.enderecoNumero),"","4","Complemento",NI(o.enderecoComplemento),"","4","Bairro",NI(o.enderecoBairrro),"","4","Município - UF",NI(o.descricaoEnderecoMunicipio)+" - "+NI(o.enderecoUf),"","4","CEP",NI(o.enderecoCep),"")},dadosDetalhe:function(o,a){var e="";isTrue(o.indicadorRouboFurto)&&(e=" sinesp-notification-alert");var i=colunasResult("12"+e,"Roubo/Furto",SimNao(o.indicadorRouboFurto),"");return i+=a?colunasResult("4","Placa",o.placa,""):"",i+=colunasResult("4","Município - UF",o.descricaoMunicipioEmplacamento+" - "+o.ufJurisdicao,"","4","Marca/Modelo",o.descricaoMarcaModelo,"","4","Cor",NI(o.descricaoCor),"","4","Ano Fabricação/Ano Modelo",o.anoFabricacao+"/"+o.anoModelo,"","4","Chassi",o.chassi,"","4","Renavam",NI(o.codigoRenavam),"","4","Câmbio",NI(o.numeroCambio),"","4","Motor",NI(o.numeroMotor),"","4","Combustível",o.descricaoCombustivel,"","4","Capacidade de Passageiros",NI(o.lotacao),"","4","Tipo do Veículo",o.descricaoTipoVeiculo,"","4","Situação do Veículo",NI(o.situacao),"","4","Espécie do Veículo",o.descricaoEspecieVeiculo,"","4","Categoria do Veículo",o.descricaoCategoria,"","4","Alarme",SimNao(o.indicadorAlarme),"","4","Quantidade de Eixos",NI(o.qtdEixos),"","4","Capacidade de Carga do Veículo",NI(o.cmc.toString()),"","4","Capacidade de Tração do Veículo",NI(o.cmt.toString()),"","4","Peso Bruto do Veículo",NI(o.pbt.toString()),"","4","Carroceria do Veículo",NI(o.descricaoTipoCarroceria),"","4","Potência do Veículo",o.potencia,"","4","Cilindradas",NI(o.cilindradas),"","4","Carroceria",NI(o.numeroCarroceria),"","4","Chassi – Nº Série",NI(o.chassiSerie),"","4","Nº do Eixo Auxiliar Original",NI(o.numeroEixoAuxiliar),"","4","Nº do Eixo Traseiro Original",NI(o.numeroEixoTraseiro),""),resultDiv(i)},dadosDocumento:function(o,a){var e=colunasResult("4","Nome Proprietário",NI(o.nomeProprietario),"","4","CPF/CNPJ do Proprietário",a?NI(o.numeroIdentificacaoProprietario):Funcoes.link(NI(o.numeroIdentificacaoProprietario)),"","4","Data da Baixa",NI(o.dataBaixa),"","4","Data da Declaração de Importação",NI(o.dataDistImportacao),"","4","Data da Última Atualização",NI(o.dataUltimaAtualizacao),"","4","Data da Última Atualização MRE",NI(o.dataAtualizacaoMre),"","4","Data de Emissão do Último CRV",NI(o.dataEmissaoCrv),"","4","Data Limite da Restrição Tributária",NI(o.dataLimite),"","4","Nº Processo de Importação",NI(o.numeroProcessoImportacao),"","4","Tipo Importação",NI(o.descricaoTipoImportacao),"","4","Tipo Documento do Importador",NI(o.descricaoDocImportador),"","4","Comunicação de Venda",SimNao(o.indicadorComunicacaoVenda),"","4","Leilão",SimNao(o.indicadorLeilao),"","4","Multa RENAINF",SimNao(o.indicadorMultaRenainf),"","4","Pendência de Emissão de CRV",SimNao(o.indicadorPendenciaEmissao),""),i="";NuloOuVazio(o.descricaoRestricao1)||(i+="<li>"+o.descricaoRestricao1+"</li>"),NuloOuVazio(o.descricaoRestricao2)||(i+="<li>"+o.descricaoRestricao2+"</li>"),NuloOuVazio(o.descricaoRestricao3)||(i+="<li>"+o.descricaoRestricao3+"</li>"),NuloOuVazio(o.descricaoRestricao4)||(i+="<li>"+o.descricaoRestricao4+"</li>"),i=NuloOuVazio(i)?"N/I":'<ul class="sinesp-list-label">'+i+"</ul>";var r="";return r+="<li>"+SimNao(o.indicadorRecall1)+"</li>",r+="<li>"+SimNao(o.indicadorRecall2)+"</li>",r+="<li>"+SimNao(o.indicadorRecall3)+"</li>",r=NuloOuVazio(r)?"N/I":'<ul class="sinesp-list-label">'+r+"</ul>",e+=colunasResult("4","Restrições",i,"","4","Restrição RFB",NI(o.descricaoRestricaoRfb),"","4","Recall",r,"","4","Recall de Montadora",SimNao(o.indicadorRecallMontadora),"","4","Restrição RENAJUD",SimNao(o.indicadorRestricaoRenajud),"","4","Natureza Faturado",NI(o.naturezaFaturado),"","4","Nº do Documento do Faturamento",NI(o.numeroIdFaturamento),"","4","Natureza do Importador",NI(o.naturezaImportador),"","4","Nº da Declaração de Importação",NI(o.numeroDeclaracaoImportacao),"","4","Nº do Documento do Importador",NI(o.numeroIdImportador),"","4","Órgão da Declaração de Importação",NI(o.descricaoOrgaoRfb),"","4","Nome Arrendatário",NI(o.nomeArrendatario),"","4","Nº do Documento do Arrendatário",NI(o.numeroIdentificacaoArrendatario),"","4","Nº de Identificação do Proprietário Indicado",NI(o.numeroDocProprietarioIndicado),"","4","Origem do Proprietário Indicado",NI(o.codigoOrigemPropriedade),"","4","País de Transferência",NI(o.descricaoPaisTransferencia),"","4","Nome Possuidor",NI(o.nomePossuidor),"","4","Nº Documento Possuidor",NI(o.numeroDocumentoPossuidor),"","4","Origem Possuidor",NI(o.origemPossuidor),"","4","Procedência",NI(o.procedencia),"","4","Registro Aduaneiro",NI(o.registroAduaneiro),"","4","Tipo de Documento do Proprietário",NI(o.descricaoTipoProprietario),"","4","Tipo de Documento do Proprietário Indicado",NI(o.descricaoDocProprietarioIndicado),"","4","Tipo de Remarcação do Chassi",NI(o.descricaoRemarcacaoChassi),"","4","UF de Jurisdição",NI(o.ufJurisdicao),"","4","UF do Faturado",NI(o.ufFaturado),""),resultDiv(e)},gerarFormularioDeFiltro:function(o,a){$(a).off("click");var e=$("<div class='sinesp-dropdown-menu sinesp-popover text-left'><form id='frm-"+o+"' class='form frm-filtro-veiculos' novalidate><input type='hidden' value='"+o+"' name='chave'/><div class='row sinesp-filter-row-small'><div class='col-md-12'><div class='form-group'><label>Placa</label><input type='text' class='form-control' id='"+o+"-placa' maxlength='10' /></div><div class='form-group'><label>Município Emplacamento</label><input type='text' class='form-control' id='"+o+"-descricaoMunicipioEmplacamento' maxlength='100' /></div><div class='form-group'><label>UF</label><select class='form-control' id='"+o+"-ufJurisdicao'>"+Funcoes.carregarListaUfs()+"</select></div><div class='form-group'><label>Marca/Modelo</label><input type='text' class='form-control' id='"+o+"-descricaoMarcaModelo' maxlength='100' /></div><div class='form-group'><label>Cor</label><input type='text' class='form-control' id='"+o+"-descricaoCor' maxlength='50' /></div><div class='form-group'><label>Indicador de Roubo/Furto</label><select class='form-control' id='"+o+"-indicadorRouboFurto'><option value=''></option><option value='true'>SIM</option><option value='false'>NÃO</option></select></div><div class='form-group text-right'><button id='"+o+"-btn-limpar-formulario' class='btn btn-primary' type='button' onclick='Filtro.limparFormulario(this.form)'>Limpar</span></button>&nbsp;&nbsp;&nbsp;<button id='"+o+"-btn-filtrar-pesquisa' type='submit' class='btn btn-primary' >Filtrar &nbsp; <span class='glyphicon glyphicon-search'></span></button></div></div></div></form></div>");$("#"+o+"-lista-filtro").append(e)}};$(function(){$("body").on("submit",".frm-filtro-veiculos",function(o){Filtro.tratarSubmit(o,this,VeiculosProxy.getVeiculoFiltro,Veiculos.listarFiltro)})});