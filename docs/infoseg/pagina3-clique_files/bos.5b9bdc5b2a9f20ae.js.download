var Bos={Proxy:{url:"api/bos",getPessoas:function(a,o){return $.ajax(AjaxWrapper.getRequest(Bos.Proxy.url+"/pessoas",a,o))},getDetalheBO:function(a,o){return $.ajax(AjaxWrapper.getRequest(Bos.Proxy.url+"/detalhe",a,o))}},consultarPessoasOk:function(a,o,e,t,i,s){var r=document.getElementById(t+"-lista-conteudo");if(null===r?(criarEstruturaListagemResultados(t),r=document.getElementById(t+"-lista-conteudo")):$(r).empty(),!0===a.success){if(null!=a.payload&&0<a.payload.length){$("#"+t).data("registros-bos",a.payload),!1!==s&&($("#"+t).data("parameters",i),Counters.counterAdd(t,COD_SERVICO.SRV_BOS,a.totalRegistros));Bos.paginaDados(t,1,10,a),Bos.paginarResultados(t,a.payload.length,a,Bos.paginaDados,10),Report.showOrHideCheckboxAll(t)}}else gerarMensagemInsucesso(r,a.msgRetorno)},paginaDados:function(a,o,e,t){var i=t.payload.length,s=document.getElementById(a+"-lista-conteudo");if(e<o||o<1||i<o)gerarMensagemInsucesso(s,"Dados de paginação inválidos");else{$(s).empty(),30<e-(o-=1)&&(e=o+30),i<e&&(e=i);for(var r=o;r<e;r++){var n=a+"-"+r;Bos.gerarDadosBasicos(s,t.payload[r],n,!1)}}},paginarResultados:function(e,a,t,i,s){null!==s&&0!==s||(s=10);var o=$("<div id='"+e+"-pag'/>");$("#"+e+"-lista-conteudo").after(o);var r=parseInt(a/s);0<a%s&&(r+=1),1<r&&(Filtro.gerarBotaoDeFiltro(e,Bos.gerarFormularioDeFiltro,COD_SERVICO.SRV_BOS,a),$(o).bootpag({total:r,page:1,maxVisible:10,firstLastUse:!0}).on("page",function(a,o){a.preventDefault(),Report.setStateCheckboxAll(e,!1),i(e,(o-1)*s+1,o*s,t)}))},consultarDetalheOk:function(a,o,e,t){var i=document.getElementById(t),s=$(i).parent();!0===a.success?null!=a.payload&&(Bos.gerarDadosDetalhados(s,a.payload,t),$(i).find(".row:eq(0)").find("div").first().find("p").off("click"),$(i).find(".row:eq(0)").find("div").first().find("p").on("click",function(){util.popOverSubEl(i.id,i.id+"-detalhe")}),util.popOverSubEl(t,t+"-detalhe")):gerarMensagemInsucesso(i,a.msgRetorno)},gerarDadosBasicos:function(a,o,e){var t=document.createElement("div");t.setAttribute("id",e),Report.checkbox(t,o.idBo,COD_SERVICO.SRV_BOS,o);var i=Bos.dadosBasicos(o,!1);$(t).append(i),$(a).append(t),$(t).find(".row:eq(0)").find("div").first().find("p").on("click",function(){Bos.realizarBuscaDetalhes(o.idBo,t)})},gerarDadosDetalhados:function(a,o,e){var t=document.createElement("div");t.setAttribute("hidden",""),t.setAttribute("id",e+"-detalhe"),t.setAttribute("title","Detalhes do BO"),Report.checkboxDetails(t,o.id,COD_SERVICO.SRV_BOS,o);var i="tab-"+e+"-envolvidos",s="tab-"+e+"-fato",r=Bos.dadosEnvolvidos(i,o.envolvidos),n='<div><ul id="ul-tab-det-'+e+'" class="nav nav-tabs"><li class="active"><a data-toggle="tab" href="#'+i+'">Envolvidos</a></li><li><a data-toggle="tab" href="#'+s+'">Fato</a></li></ul><div id="ul-tab-det-content-'+e+'" class="tab-content"><div id="'+i+'" class="tab-pane fade in list active">'+(r+=Bos.dadosPessoas(o.listaPessoas,!1))+'</div><div id="'+s+'" class="tab-pane fade in">'+Bos.dadosFato(o,!1)+"</div></div><div>";$(t).append(n),$(a).append(t)},realizarBuscaDetalhes:function(a,o){var e={id:a};genericRequest(Bos.Proxy.getDetalheBO,e,Bos.consultarDetalheOk,o.id)},reportItem:function(a,o,e){var t=document.createElement("div");t.setAttribute("id",e);var i=Bos.dadosBasicos(o,!0);$(t).append(i),$(a).append(t),$(t).find(".row:eq(0)").find("div").first().find("p").on("click",function(){Bos.realizarBuscaDetalhesParaAdicionarNoRelatorio(o.idBo,t)})},reportItemDetalhe:function(a,o,e){var t=document.createElement("div");t.setAttribute("id",e);var i=Bos.dadosEnvolvidos(e,o.envolvidos);i+=Funcoes.criarTituloLista("Envolvidos",Bos.dadosPessoas(o.listaPessoas,!0)),i+=Funcoes.criarTituloLista("Fato",Bos.dadosFato(o,!0)),$(t).append(i),$(a).append(t)},dadosBasicos:function(a,o){var e=colunaResultComBandeira("4","Nome",a.nome,NI(a.uf)),t=colunasResult("3","Mãe",o?NI(a.nomeMae):Funcoes.linkGenitora(NI(a.nomeMae)),"","2","CPF",o?formatarCpf(a.cpf):Funcoes.link(formatarCpf(a.cpf)),"","1","D. N.",NI(a.dataNascimento),"Data de Nascimento","2","Número BO",NI(a.numeroBo),"");return resultDiv(e+t)},dadosPessoas:function(a,o){var e="";if(null!=a&&0<a.length)for(var t=0;t<a.length;t++)e+=Bos.dadosEnvolvido(a[t].pessoa);else o||(e="Nenhum registro encontrado.");return e},dadosEnvolvidos:function(a,o){var e="";if(null!=o&&0<o.length){for(var t=[],i=0;i<o.length;i++){var s=[];s.push(o[i]),t.push(s)}e=Funcoes.criarTabela(a+"-listaIndividuos",["Resumo"],["90"],t)}return e},dadosEnvolvido:function(a,o){var e=colunasResult("4","Nome",NI(a.nome),"","4","Mãe",o?NI(a.nomeMae):Funcoes.linkGenitora(NI(a.nomeMae)),"","4","CPF",o?formatarCpf(a.cpf):Funcoes.link(formatarCpf(a.cpf)),"","4","D. N.",NI(a.dataNascimento),"Data de Nascimento","4","Email",NI(a.email),"","4","Logradouro, Nº",NI(a.logradouro)+", "+NI(a.numero),"","4","Complemento",NI(a.complemento),"","4","Bairro",NI(a.bairro),"","4","Município - UF",NI(a.provinciaMunicipio)+" - "+NI(a.idUf),"","4","CEP",NI(a.cep),"");return null!=a.pessoaFisica&&(e+=colunasResult("4","Alcunha",NI(a.pessoaFisica.alcunha),"","4","Nome Social",NI(a.pessoaFisica.nomeSocial),"","4","Nome Mãe",NI(a.pessoaFisica.nomeMae),"","4","Nome Pai",NI(a.pessoaFisica.nomePai),"","4","Escolaridade",NI(a.pessoaFisica.escolaridade),"","4","Sexo",NI(a.pessoaFisica.sexo),"","4","Idade Aproximada",NI(a.pessoaFisica.idadeAproximada),"","4","Estado Civil",NI(a.pessoaFisica.estadoCivil),"","4","Orientação Sexual",NI(a.pessoaFisica.orientacaoSexual),"","4","Cor",NI(a.pessoaFisica.racaCor),"","4","Tipo Físico",NI(a.pessoaFisica.tipoFisico),"")),null!=a.pessoaJuridica&&(e+=colunasResult("4","Razão Social",NI(a.pessoaJuridica.razaoSocial),"","4","Nome Fantasia",NI(a.pessoaJuridica.nomeFantasia),"","4","CNPJ",NI(a.pessoaJuridica.cnpj),"","4","Nome Representante",NI(a.pessoaJuridica.nomeRepresentante),"")),resultDiv(e)},dadosFato:function(a){var o=colunasResult("4","Número BO",NI(a.numeroRegistro),"","4","Número BO Nacional",NI(a.numeroNacional),"");return null!=a.enderecoFato&&(o+=colunasResult("4","Logradouro, Nº",NI(a.enderecoFato.logradouro)+", "+NI(a.enderecoFato.numero),"","4","Complemento",NI(a.enderecoFato.complemento),"","4","Ponto de Referência",NI(a.enderecoFato.pontoReferencia),"","4","Bairro",NI(a.enderecoFato.bairro),"","4","CEP",NI(a.enderecoFato.cep),"")),o+=colunasResult("4","Fornecida/Atualizada",NI(a.dataRegistro),"","4","Delegacia de Registro",NuloOuVazio(a.delegaciaRegistro)?"N/I":NI(a.delegaciaRegistro.nome),"","4","Delegacia de Afeto",NuloOuVazio(a.delegaciaAfeto)?"N/I":NI(a.delegaciaAfeto.nome),"","4","Situação Atual",NI(a.situacaoAtual),"","12","Relato Histórico",Funcoes.htmlDecode(NI(a.relatoHistorico)),""),resultDiv(o)},realizarBuscaDetalhesParaAdicionarNoRelatorio:function(o,e){util.confirm("Confirma a inclusão do detalhamento do item no relatório?").done(function(){var a={id:o};genericRequest(Bos.Proxy.getDetalheBO,a,Bos.consultarDetalhesParaAdicionarNoRelatorioOk,e.id)}).fail()},consultarDetalhesParaAdicionarNoRelatorioOk:function(a,o,e,t){Report.adicionaDetalhamentoItem(a,t,COD_SERVICO.SRV_BOS,"id")},gerarFormularioDeFiltro:function(a,o){$(o).off("click");var e=$("<div class='sinesp-dropdown-menu sinesp-popover text-left'><form id='frm-"+a+"' class='form frm-filtro-bos' novalidate><input type='hidden' value='"+a+"' name='chave'/><div class='row sinesp-filter-row-small'><div class='col-md-12'><div class='form-group'><label>Nome</label><input type='text' class='form-control' id='"+a+"-nome' maxlength='100' /></div><div class='form-group'><label>Mãe</label><input type='text' class='form-control' id='"+a+"-mae' maxlength='100' /></div><div class='form-group'><label>Data de Nascimento</label><input type='text' class='form-control' id='"+a+"-dataNascimento' maxlength='10' /></div><div class='form-group'><label>CPF</label><input type='text' class='form-control' id='"+a+"-cpf' maxlength='11'  onkeypress='return Funcoes.isNumeroDigitado(event)'/></div><div class='form-group'><label>Número BO</label><input type='text' class='form-control' id='"+a+"-numeroBO' maxlength='50'  onkeypress='return Funcoes.isDataDigitada(event)'/></div><div class='form-group text-right'><button id='"+a+"-btn-limpar-formulario' class='btn btn-primary' type='button' onclick='Filtro.limparFormulario(this.form)'>Limpar</span></button>&nbsp;&nbsp;&nbsp;<button id='"+a+"-btn-filtrar-pesquisa' type='submit' class='btn btn-primary' >Filtrar &nbsp; <span class='glyphicon glyphicon-search'></span></button></div></div></div></form></div>");$("#"+a+"-lista-filtro").append(e)},consultarFiltro:function(a,o){a.preventDefault();var e=o.elements.chave.value,t=$("#"+e).data("registros-bos");$("#"+e+"-lista-filtro").attr("data-active",""),$("#"+e+"-lista-filtro > div").attr("style","right: 0px; display: none;");var i=[{filtro:e+"-nome",campo:"nome"},{filtro:e+"-mae",campo:"nomeMae"},{filtro:e+"-dataNascimento",campo:"dataNascimento"},{filtro:e+"-cpf",campo:"cpf"},{filtro:e+"-numeroBO",campo:"numeroBo"}],s=Filtro.filtrarRegistros(i,t),r=[];0<s.length?(r.success=!0,r.payload=s,r.msgRetorno="Filtro retornou "+s.length+" resultados"):(r.success=!1,r.msgRetorno="Nenhum registro encontrado!"),Bos.consultarFiltroOk(r,e)},consultarFiltroOk:function(a,o){Filtro.limparListagemConteudo(o);!0===a.success&&null!=a.payload&&0<a.payload.length&&(Bos.paginaDados(o,1,10,a),Bos.paginarResultados(o,a.payload.length,a,Bos.paginaDados,10),Report.showOrHideCheckboxAll(o)),Filtro.mostrarMensagemFiltro(o,a.msgRetorno)}};$(function(){$("body").on("submit",".frm-filtro-bos",function(a){Bos.consultarFiltro(a,this)})});